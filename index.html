<!DOCTYPE html>
<html lang="en">
<!--[if IE 9]>
    <html class="ie9" lang="en">    <![endif]-->
<!--[if IE 8]>
    <html class="ie8" lang="en">    <![endif]-->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="robots" content="noindex">

    <meta name="description" content="">
    <meta name="keywords" content="">

    <meta name=viewport content="width=device-width, initial-scale=1">

    <meta name="Copyright" content="">

    <title>The plunge</title>

    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!--[if lt IE 8]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!--[if lt IE 7]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- <link rel="icon" href="favicon.ico" sizes="16x16" type="image/png"> -->

<!-- fonts -->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>

<!-- css -->
<link href='/style.css' rel='stylesheet' type='text/css'>

</head>

<body>

    <header>
        <h1>the plunge</h1>
    </header>

    <div id="plunge" class="container">
            <p class="plunge-text">#plunge</p>
            <p class="canvas-text">v This is my canvas v</p>
    </div>

    <footer>
        <p>This is my footer</p>
    </footer>

    <!-- <script src="/app.js"></script> -->

    <!-- socket.io -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- pixi.js -->
    <script src="node_modules/pixi.js/bin/pixi.min.js"></script>

    <script>
        window.onload = function() {

            // socket connection
            var socket = io.connect('http://localhost:8080');

            // create the renderer
            var renderer = PIXI.autoDetectRenderer(400, 2000, {
                backgroundColor : 0x1E2A2D,
                antialias: false,
                transparent: false,
                resolution: 1
            });

            renderer.view.style.border = "1px solid white"; // canvas border

            // new container object called 'stage'
            var stage = new PIXI.Container();

            var i = 0;

            socket.on('tweet', function(tweet) {
                var username = tweet.user.name; // tweet username
                var text = tweet.text; // tweet text

                var style = {
                    font: "12px sans-serif",
                    fill: "white",
                    wordWrap : true,
                    wordWrapWidth : renderer.width // word wrap > canvas size
                };

                //console.log(i+' > user = '+tweet.user.name+' text = '+text+' media = '+media);

                var message = new PIXI.Text(text, style);

                message.x = 10;
                message.y = i * 200;

                stage.addChild(message);

                if (typeof(tweet.entities.media) !== 'undefined') {

                    var media = tweet.entities.media[0];

                    console.log('MEDIA > ', media, ' id = ', media.id, ' type=', media.type, ' url =', media.media_url);

                    if (media.type == 'photo') {

                        var image = PIXI.Sprite.fromImage(media.media_url);

                        //image.scale.set(0.5,0.5)

                        image.width = 100;
                        image.height = 100; // auto ?

                        image.interactive = true;
                        image.click = function(data) {
                            console.log("Image click!!!");
                        }

                        //console.log('Image > ', image);

                        image.x = 0;
                        image.y = message.y + 50; // 50px under the text


                        stage.addChild(image);

                    } else if (media.type == 'video') {

                        console.log('VIDEO!!! ', media.media_url);


                        // create a video texture from a path
                        var texture = PIXI.Texture.fromVideo(media.media_url);

                        // create a new Sprite using the video texture (yes it's that easy)
                        var videoSprite = new PIXI.Sprite(texture);

                        videoSprite.width = 300;
                        videoSprite.height = 300; // auto ?

                        stage.addChild(videoSprite);
                    }
                }

                i++;
            });

            // add the canvas to the plunge div
            var plunge = document.getElementById('plunge');
            plunge.appendChild(renderer.view);

            // start animating
            animate();

            function animate() {

                requestAnimationFrame(animate);

                // render the root container
                renderer.render(stage);
            }
        }
    </script>

</body>
</html>
